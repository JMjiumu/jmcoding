import { resolveComponent, useSSRContext } from "vue";
import { ssrRenderAttrs, ssrRenderComponent } from "vue/server-renderer";
import { _ as _export_sfc } from "./plugin-vue_export-helper-cc2b3d55.js";
const _sfc_main = {};
function _sfc_ssrRender(_ctx, _push, _parent, _attrs) {
  const _component_ExternalLinkIcon = resolveComponent("ExternalLinkIcon");
  _push(`<div${ssrRenderAttrs(_attrs)}><h1 id="springcloud02" tabindex="-1"><a class="header-anchor" href="#springcloud02" aria-hidden="true">#</a> SpringCloud02</h1><blockquote><p>byä¹ç‰§</p></blockquote><h1 id="_0-å­¦ä¹ ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_0-å­¦ä¹ ç›®æ ‡" aria-hidden="true">#</a> 0. å­¦ä¹ ç›®æ ‡</h1><h1 id="_1-nacosé…ç½®ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_1-nacosé…ç½®ç®¡ç†" aria-hidden="true">#</a> 1. Nacosé…ç½®ç®¡ç†</h1><blockquote><p><code>Nacos</code> é™¤äº†å¯ä»¥åšæ³¨å†Œä¸­å¿ƒï¼ŒåŒæ ·å¯ä»¥åšé…ç½®ç®¡ç†æ¥ä½¿ç”¨</p></blockquote><h2 id="_1-1-ç»Ÿä¸€é…ç½®ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_1-1-ç»Ÿä¸€é…ç½®ç®¡ç†" aria-hidden="true">#</a> 1.1 ç»Ÿä¸€é…ç½®ç®¡ç†</h2><blockquote><p>å½“å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤šï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±ä¼šè®©äººæŠ“ç‹‚ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®</p></blockquote><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714164426792.png" alt="image-20210714164426792"></p><blockquote><p><code>Nacos</code> ä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°</p></blockquote><h3 id="_1-1-1-åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-1-1-åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 1.1.1 åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶</h3><p>å¦‚ä½•åœ¨ <code>nacos</code> ä¸­ç®¡ç†é…ç½®å‘¢ï¼Ÿ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714164742924.png" alt="image-20210714164742924"></p><p>ç„¶ååœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œå¡«å†™é…ç½®ä¿¡æ¯ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714164856664.png" alt="image-20210714164856664"></p><blockquote><p><strong>æ³¨æ„</strong>ï¼šé¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ° <code>nacos</code> ç®¡ç†çš„å¿…è¦ï¼ŒåŸºæœ¬ä¸ä¼šå˜æ›´çš„ä¸€äº›é…ç½®è¿˜æ˜¯ä¿å­˜åœ¨å¾®æœåŠ¡æœ¬åœ°æ¯”è¾ƒå¥½</p></blockquote><h3 id="_1-1-2-ä»å¾®æœåŠ¡æ‹‰å–é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-1-2-ä»å¾®æœåŠ¡æ‹‰å–é…ç½®" aria-hidden="true">#</a> 1.1.2 ä»å¾®æœåŠ¡æ‹‰å–é…ç½®</h3><blockquote><p>å¾®æœåŠ¡è¦æ‹‰å– <code>nacos</code> ä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„ <code>application.yml</code> é…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚ä½†å¦‚æœå°šæœªè¯»å– <code>application.yml</code>ï¼Œåˆå¦‚ä½•å¾—çŸ¥ <code>nacos</code> åœ°å€å‘¢ï¼Ÿ</p><p>å› æ­¤ <code>Spring</code> å¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼š<code>bootstrap.yaml</code> æ–‡ä»¶ï¼Œä¼šåœ¨ <code>application.yml</code> ä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/L0iFYNF.png" alt="img"></p></blockquote><h4 id="_1ã€å¼•å…¥nacos-configä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1ã€å¼•å…¥nacos-configä¾èµ–" aria-hidden="true">#</a> 1ã€å¼•å…¥nacos-configä¾èµ–</h4><p>é¦–å…ˆï¼Œåœ¨ <code>user-service</code> æœåŠ¡ä¸­ï¼Œå¼•å…¥ <code>nacos-config</code> çš„å®¢æˆ·ç«¯ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2ã€æ·»åŠ bootstrap-yaml" tabindex="-1"><a class="header-anchor" href="#_2ã€æ·»åŠ bootstrap-yaml" aria-hidden="true">#</a> 2ã€æ·»åŠ bootstrap.yaml</h4><p>ç„¶åï¼Œåœ¨ <code>user-service</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>bootstrap.yaml</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice <span class="token comment"># æœåŠ¡åç§°</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># Nacosåœ°å€</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment"># æ–‡ä»¶åç¼€å</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è¿™é‡Œä¼šæ ¹æ® <code>spring.cloud.nacos.server-addr</code> è·å– <code>nacos</code> åœ°å€ï¼Œå†æ ¹æ®<code>\${spring.application.name}-\${spring.profiles.active}.\${spring.cloud.nacos.config.file-extension}</code> ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®</p><p><strong>æ³¨æ„</strong>ï¼šæœ€å¥½æ˜¯åˆ é™¤æˆ–è€…æ³¨é‡Šæ‰ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­çš„ç›¸åŒå†…å®¹</p></blockquote><p>æœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å– <code>userservice-dev.yaml</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714170845901.png" alt="image-20210714170845901"></p><h4 id="_3ã€è¯»å–nacosé…ç½®" tabindex="-1"><a class="header-anchor" href="#_3ã€è¯»å–nacosé…ç½®" aria-hidden="true">#</a> 3ã€è¯»å–nacosé…ç½®</h4><p>åœ¨ <code>user-service</code> ä¸­çš„ <code>UserController</code> ä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼Œè¯»å– <code>pattern.dateformat</code> é…ç½®ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123204025921.png" alt="image-20230123204025921"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å®Œæ•´ä»£ç </span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormatter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${pattern.dateformat}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dateformat<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>dateformat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...ç•¥</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>åœ¨é¡µé¢è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123204116607.png" alt="image-20230123204116607"></p></blockquote><h2 id="_1-2-é…ç½®çƒ­æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#_1-2-é…ç½®çƒ­æ›´æ–°" aria-hidden="true">#</a> 1.2 é…ç½®çƒ­æ›´æ–°</h2><blockquote><p>æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹ <code>nacos</code> ä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ï¼Œè¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼</p></blockquote><h3 id="_1-2-1-æ–¹å¼ä¸€" tabindex="-1"><a class="header-anchor" href="#_1-2-1-æ–¹å¼ä¸€" aria-hidden="true">#</a> 1.2.1 æ–¹å¼ä¸€</h3><p>åœ¨ <code>@Value</code> æ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@RefreshScope</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714171036335.png" alt="image-20210714171036335"></p><h3 id="_1-2-2-æ–¹å¼äºŒ" tabindex="-1"><a class="header-anchor" href="#_1-2-2-æ–¹å¼äºŒ" aria-hidden="true">#</a> 1.2.2 æ–¹å¼äºŒ</h3><p>ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£ä»£æ›¿ <code>@Value</code> æ³¨è§£ã€‚</p><p>åœ¨ <code>user-service</code> æœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å– <code>patterrn.dateformat</code> å±æ€§ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;pattern&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PatternProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dateformat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>UserController</code> ä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿ <code>@Value</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714171316124.png" alt="image-20210714171316124"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å®Œæ•´ä»£ç </span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">PatternProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>user<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RefreshScope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormatter</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PatternProperties</span> patternProperties<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span>patternProperties<span class="token punctuation">.</span><span class="token function">getDateformat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ç•¥</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-3-é…ç½®å…±äº«" tabindex="-1"><a class="header-anchor" href="#_1-3-é…ç½®å…±äº«" aria-hidden="true">#</a> 1.3 é…ç½®å…±äº«</h2><blockquote><p>å…¶å®å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå» <code>nacos</code> è¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>[spring.application.name]-[spring.profiles.active].yaml</code>ï¼Œå¦‚ï¼š<code>userservice-dev.yaml</code></li><li><code>[spring.application.name].yaml</code>ï¼Œå¦‚ï¼š<code>userservice.yaml</code></li></ul><p>è€Œ<code>[spring.application.name].yaml</code>ä¸åŒ…å«ç¯å¢ƒï¼Œå› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«ï¼ˆä¸‹é¢æˆ‘ä»¬é€šè¿‡æ¡ˆä¾‹æ¥æµ‹è¯•é…ç½®å…±äº«ï¼‰</p></blockquote><h3 id="_1ã€æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1ã€æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®" aria-hidden="true">#</a> 1ã€æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®</h3><p>æˆ‘ä»¬åœ¨ <code>nacos</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>userservice.yaml</code> æ–‡ä»¶ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714173233650.png" alt="image-20210714173233650"></p><blockquote><p>ä¸Šé¢çš„ <code>envSharedValue</code> çš„å€¼æ²¡ä»€ä¹ˆç‰¹æ®Šå«ä¹‰ï¼Œå°±æ˜¯ä¸ºäº†æµ‹è¯•</p></blockquote><h3 id="_2ã€åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2ã€åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®" aria-hidden="true">#</a> 2ã€åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®</h3><p>åœ¨ <code>user-service</code> æœåŠ¡ä¸­ï¼Œä¿®æ”¹ <code>PatternProperties</code> ç±»ï¼Œè¯»å–æ–°æ·»åŠ çš„å±æ€§ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714173324231.png" alt="image-20210714173324231"></p><p>åœ¨ <code>user-service</code> æœåŠ¡ä¸­ï¼Œä¿®æ”¹ <code>UserController</code>ï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123211159895.png" alt="image-20230123211159895"></p><h3 id="_3ã€è¿è¡Œä¸¤ä¸ªuserapplication-ä½¿ç”¨ä¸åŒçš„profile" tabindex="-1"><a class="header-anchor" href="#_3ã€è¿è¡Œä¸¤ä¸ªuserapplication-ä½¿ç”¨ä¸åŒçš„profile" aria-hidden="true">#</a> 3ã€è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile</h3><p>ä¿®æ”¹ <code>UserApplication2</code> è¿™ä¸ªå¯åŠ¨é¡¹ï¼Œæ”¹å˜å…¶ <code>profile</code> å€¼ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714173538538.png" alt="image-20210714173538538"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714173519963.png" alt="image-20210714173519963"></p><blockquote><p>è¿™æ ·ï¼Œ<code>UserApplication(8081)</code> ä½¿ç”¨çš„ <code>profile</code> æ˜¯ <code>dev</code>ï¼Œ<code>UserApplication2(8082)</code> ä½¿ç”¨çš„ <code>profile</code> æ˜¯<code>test</code></p><p><strong>å¯åŠ¨å‰</strong>è®°å¾—æŠŠ <code>UserController</code> ä¸­çš„ <code>dateformat</code> è¿›è¡Œæ³¨é‡Šï¼Œå› ä¸ºä½¿ç”¨ <code>UserApplication2(8082)</code> è¿›è¡Œè®¿é—®æ—¶ä¼šæŠ¥é”™ï¼ˆæ‰¾ä¸åˆ° <code>dateformat</code> çš„å€¼ï¼‰</p></blockquote><p>å¯åŠ¨ <code>UserApplication</code> å’Œ <code>UserApplication2</code>ï¼Œè®¿é—®<a href="http://localhost:8081/user/prop%EF%BC%8C%E7%BB%93%E6%9E%9C%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://localhost:8081/user/propï¼Œç»“æœï¼š`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123211607466.png" alt="image-20230123211607466"></p><p>è®¿é—®<a href="http://localhost:8082/user/prop%EF%BC%8C%E7%BB%93%E6%9E%9C%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://localhost:8082/user/propï¼Œç»“æœï¼š`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123211617922.png" alt="image-20230123211617922"></p><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ç®¡æ˜¯ <code>dev</code>ï¼Œè¿˜æ˜¯ <code>test</code> ç¯å¢ƒï¼Œéƒ½è¯»å–åˆ°äº† <code>envSharedValue</code> è¿™ä¸ªå±æ€§çš„å€¼ã€‚</p><h3 id="_4ã€é…ç½®å…±äº«çš„ä¼˜å…ˆçº§" tabindex="-1"><a class="header-anchor" href="#_4ã€é…ç½®å…±äº«çš„ä¼˜å…ˆçº§" aria-hidden="true">#</a> 4ã€é…ç½®å…±äº«çš„ä¼˜å…ˆçº§</h3><p>å½“ <code>nacos</code>ã€æœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714174623557.png" alt="image-20210714174623557"></p><h2 id="_1-4-æ­å»ºnacosé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_1-4-æ­å»ºnacosé›†ç¾¤" aria-hidden="true">#</a> 1.4 æ­å»ºNacosé›†ç¾¤</h2><p><code>Nacos</code> ç”Ÿäº§ç¯å¢ƒä¸‹ä¸€å®šè¦éƒ¨ç½²ä¸ºé›†ç¾¤çŠ¶æ€ï¼Œéƒ¨ç½²æ–¹å¼å‚è€ƒè¯¾å‰èµ„æ–™ä¸­çš„æ–‡æ¡£ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714174728042.png" alt="image-20210714174728042"></p><h1 id="_2-feignè¿œç¨‹è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_2-feignè¿œç¨‹è°ƒç”¨" aria-hidden="true">#</a> 2. Feignè¿œç¨‹è°ƒç”¨</h1><p>å…ˆæ¥çœ‹æˆ‘ä»¬ä»¥å‰åˆ©ç”¨ <code>RestTemplate</code> å‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714174814204.png" alt="image-20210714174814204"></p><p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li><p>ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€</p></li><li><p>å‚æ•°å¤æ‚ <code>URL</code> éš¾ä»¥ç»´æŠ¤</p></li></ul><blockquote><p>è€Œ<code>Feign</code> æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ <code>http</code> å®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼š<a href="https://github.com/OpenFeign/feign%EF%BC%8C%E5%85%B6%E4%BD%9C%E7%94%A8%E5%B0%B1%E6%98%AF%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener noreferrer">https://github.com/OpenFeign/feignï¼Œå…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a> <code>http</code> è¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p></blockquote><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714174918088.png" alt="image-20210714174918088"></p><h2 id="_2-1-feignæ›¿ä»£resttemplate" tabindex="-1"><a class="header-anchor" href="#_2-1-feignæ›¿ä»£resttemplate" aria-hidden="true">#</a> 2.1 Feignæ›¿ä»£RestTemplate</h2><blockquote><p><code>Fegin</code> çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹</p></blockquote><h3 id="_1ã€å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1ã€å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> 1ã€å¼•å…¥ä¾èµ–</h3><p>æˆ‘ä»¬åœ¨ <code>order-service</code> æœåŠ¡çš„ <code>pom</code> æ–‡ä»¶ä¸­å¼•å…¥ <code>feign</code> çš„ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€æ·»åŠ æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_2ã€æ·»åŠ æ³¨è§£" aria-hidden="true">#</a> 2ã€æ·»åŠ æ³¨è§£</h3><p>åœ¨ <code>order-service</code> çš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯ <code>Feign</code> çš„åŠŸèƒ½ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123213657520.png" alt="image-20230123213657520"></p><h3 id="_3ã€ç¼–å†™feignçš„å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3ã€ç¼–å†™feignçš„å®¢æˆ·ç«¯" aria-hidden="true">#</a> 3ã€ç¼–å†™Feignçš„å®¢æˆ·ç«¯</h3><p>åœ¨ <code>order-service</code> ä¸­æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>order<span class="token punctuation">.</span>client</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>order<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;userservice&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäº <code>SpringMVC</code> çš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>æœåŠ¡åç§°ï¼š<code>userservice</code></li><li>è¯·æ±‚æ–¹å¼ï¼š<code>GET</code></li><li>è¯·æ±‚è·¯å¾„ï¼š<code>/user/{id}</code></li><li>è¯·æ±‚å‚æ•°ï¼š<code>Long id</code></li><li>è¿”å›å€¼ç±»å‹ï¼š<code>User</code></li></ul><p>è¿™æ ·ï¼Œ<code>Feign</code> å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€ <code>http</code> è¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨ <code>RestTemplate</code> æ¥å‘é€äº†ã€‚</p><h3 id="_4ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4ã€æµ‹è¯•" aria-hidden="true">#</a> 4ã€æµ‹è¯•</h3><p>ä¿®æ”¹ <code>order-service</code> ä¸­çš„ <code>OrderService</code> ç±»ä¸­çš„ <code>queryOrderById</code> æ–¹æ³•ï¼Œä½¿ç”¨ <code>Feign</code> å®¢æˆ·ç«¯ä»£æ›¿ <code>RestTemplate</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20230123214611447.png" alt="image-20230123214611447"></p><blockquote><p>æ˜¯ä¸æ˜¯çœ‹èµ·æ¥ä¼˜é›…å¤šäº†ğŸ¤©</p></blockquote><h3 id="_5ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5ã€æ€»ç»“" aria-hidden="true">#</a> 5ã€æ€»ç»“</h3><blockquote><p>ä½¿ç”¨ <code>Feign</code> çš„æ­¥éª¤ï¼š</p><p>â‘  å¼•å…¥ä¾èµ–</p><p>â‘¡ æ·»åŠ  <code>@EnableFeignClients</code> æ³¨è§£</p><p>â‘¢ ç¼–å†™ <code>FeignClient</code> æ¥å£</p><p>â‘£ ä½¿ç”¨ <code>FeignClient</code> ä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿ <code>RestTemplate</code></p></blockquote><h2 id="_2-2-è‡ªå®šä¹‰é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-è‡ªå®šä¹‰é…ç½®" aria-hidden="true">#</a> 2.2 è‡ªå®šä¹‰é…ç½®</h2><p><code>Feign</code> å¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>ç±»å‹</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>feign.Logger.Level</strong></td><td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td><td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td></tr><tr><td>feign.codec.Decoder</td><td>å“åº”ç»“æœçš„è§£æå™¨</td><td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td></tr><tr><td>feign.codec.Encoder</td><td>è¯·æ±‚å‚æ•°ç¼–ç </td><td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td></tr><tr><td>feign. Contract</td><td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td><td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td></tr><tr><td>feign. Retryer</td><td>å¤±è´¥é‡è¯•æœºåˆ¶</td><td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td></tr></tbody></table><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„ <code>@Bean</code> è¦†ç›–é»˜è®¤ <code>Bean</code> å³å¯</p></blockquote><p>ä¸‹é¢ä»¥æ—¥å¿—ä¸ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®</p><h3 id="_2-2-1-é…ç½®æ–‡ä»¶æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-2-1-é…ç½®æ–‡ä»¶æ–¹å¼" aria-hidden="true">#</a> 2.2.1 é…ç½®æ–‡ä»¶æ–¹å¼</h3><p>åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹ <code>feign</code> çš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>  
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span> 
      <span class="token key atrule">userservice</span><span class="token punctuation">:</span> <span class="token comment"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL <span class="token comment">#  æ—¥å¿—çº§åˆ« </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>  
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span> 
      <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token comment"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> FULL <span class="token comment">#  æ—¥å¿—çº§åˆ« </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p><ul><li><code>NONE</code>ï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li><li><code>BASIC</code>ï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼Œ<code>URL</code> ä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li><li><code>HEADERS</code>ï¼šåœ¨ <code>BASIC</code> çš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li><code>FULL</code>ï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li></ul><h3 id="_2-2-2-javaä»£ç æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-2-2-javaä»£ç æ–¹å¼" aria-hidden="true">#</a> 2.2.2 Javaä»£ç æ–¹å¼</h3><p>ä¹Ÿå¯ä»¥åŸºäº <code>Java</code> ä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ª <code>Logger.Level</code> çš„å¯¹è±¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultFeignConfiguration</span>  <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">BASIC</span><span class="token punctuation">;</span> <span class="token comment">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦<strong>å…¨å±€ç”Ÿæ•ˆ</strong>ï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„ <code>@EnableFeignClients</code> è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span> <span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯<strong>å±€éƒ¨ç”Ÿæ•ˆ</strong>ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„ <code>@FeignClient</code> è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userservice&quot;</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span> <span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-3-feignä½¿ç”¨ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-3-feignä½¿ç”¨ä¼˜åŒ–" aria-hidden="true">#</a> 2.3 Feignä½¿ç”¨ä¼˜åŒ–</h2><blockquote><p><code>Feign</code> åº•å±‚å‘èµ· <code>http</code> è¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ï¼Œå…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><ul><li><code>URLConnection</code>ï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </li><li><code>Apache HttpClient</code> ï¼šæ”¯æŒè¿æ¥æ± </li><li><code>OKHttp</code>ï¼šæ”¯æŒè¿æ¥æ± </li></ul></blockquote><p>å› æ­¤æé«˜ <code>Feign</code> çš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„ <code>URLConnection</code>ï¼Œ è¿™é‡Œæˆ‘ä»¬ç”¨ <code>Apache</code> çš„<code>HttpClient</code> æ¥æ¼”ç¤ºã€‚</p><h4 id="_1ã€å¼•å…¥ä¾èµ–-1" tabindex="-1"><a class="header-anchor" href="#_1ã€å¼•å…¥ä¾èµ–-1" aria-hidden="true">#</a> 1ã€å¼•å…¥ä¾èµ–</h4><p>åœ¨ <code>order-service</code> çš„ <code>pom</code> æ–‡ä»¶ä¸­å¼•å…¥ <code>Apache</code> çš„ <code>HttpClient</code> ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--httpClientçš„ä¾èµ– --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2ã€é…ç½®è¿æ¥æ± " tabindex="-1"><a class="header-anchor" href="#_2ã€é…ç½®è¿æ¥æ± " aria-hidden="true">#</a> 2ã€é…ç½®è¿æ¥æ± </h4><p>åœ¨ <code>order-service</code> çš„ <code>application.yml</code> ä¸­æ·»åŠ é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token comment"># defaultå…¨å±€çš„é…ç½®</span>
        <span class="token key atrule">loggerLevel</span><span class="token punctuation">:</span> BASIC <span class="token comment"># æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</span>
  <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span>
    <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token comment"># æœ€å¤§çš„è¿æ¥æ•°</span>
    <span class="token key atrule">max-connections-per-route</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ <code>FeignClientFactoryBean</code> ä¸­çš„ <code>loadBalance</code> æ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714185925910.png" alt="image-20210714185925910"></p><p><code>Debug</code> æ–¹å¼å¯åŠ¨ <code>order-service</code> æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ <code>client</code>ï¼Œåº•å±‚å°±æ˜¯ <code>Apache HttpClient</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714190041542.png" alt="image-20210714190041542"></p><h4 id="_3ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_3ã€æ€»ç»“" aria-hidden="true">#</a> 3ã€æ€»ç»“</h4><p><code>Feign</code> çš„ä¼˜åŒ–ï¼š</p><ol><li><p>æ—¥å¿—çº§åˆ«å°½é‡ç”¨ <code>basic</code></p></li><li><p>ä½¿ç”¨ <code>HttpClient</code> æˆ– <code>OKHttp</code> ä»£æ›¿ <code>URLConnection</code></p><ol><li>å¼•å…¥ <code>feign-httpClient</code> ä¾èµ–</li><li>é…ç½®æ–‡ä»¶å¼€å¯ <code>httpClient</code> åŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°</li></ol></li></ol><h2 id="_2-4-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#_2-4-æœ€ä½³å®è·µ" aria-hidden="true">#</a> 2.4 æœ€ä½³å®è·µ</h2><blockquote><p>æ‰€è°“æœ€ä½³å®è·µï¼Œå°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒï¼Œæœ€å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ã€‚è‡ªä¹ è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œ<code>Feign</code> çš„å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›è€…çš„ <code>controller</code> ä»£ç éå¸¸ç›¸ä¼¼</p></blockquote><p><code>feign</code>å®¢æˆ·ç«¯ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714190542730.png" alt="image-20210714190542730"></p><p><code>UserController</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714190528450.png" alt="image-20210714190528450"></p><p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ç®€åŒ–è¿™ç§é‡å¤çš„ä»£ç ç¼–å†™å‘¢ï¼Ÿ</p><h3 id="_2-4-1-ç»§æ‰¿æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-4-1-ç»§æ‰¿æ–¹å¼" aria-hidden="true">#</a> 2.4.1 ç»§æ‰¿æ–¹å¼</h3><p>ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š</p><ol><li><p>å®šä¹‰ä¸€ä¸ª <code>API</code> æ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäº <code>SpringMVC</code> æ³¨è§£åšå£°æ˜</p></li><li><p><code>Feign</code> å®¢æˆ·ç«¯å’Œ <code>Controller</code> éƒ½é›†æˆæ”¹æ¥å£</p></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714190640857.png" alt="image-20210714190640857"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•</li><li>å®ç°äº†ä»£ç å…±äº«</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><p>æœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ</p></li><li><p>å‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤ <code>Controller</code> ä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£</p></li></ul><h3 id="_2-4-2-æŠ½å–æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_2-4-2-æŠ½å–æ–¹å¼" aria-hidden="true">#</a> 2.4.2 æŠ½å–æ–¹å¼</h3><p>å°† <code>Feign</code> çš„ <code>Client</code> æŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„ <code>POJO</code>ã€é»˜è®¤çš„ <code>Feign</code> é…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå°† <code>UserClient</code>ã€<code>User</code>ã€<code>Feign</code> çš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ª <code>feign-api</code> åŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714214041796.png" alt="image-20210714214041796"></p><h3 id="_2-4-3-å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#_2-4-3-å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ" aria-hidden="true">#</a> 2.4.3 å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ</h3><h4 id="_1ã€æŠ½å–" tabindex="-1"><a class="header-anchor" href="#_1ã€æŠ½å–" aria-hidden="true">#</a> 1ã€æŠ½å–</h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>module</code>ï¼Œå‘½åä¸º <code>feign-api</code>ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714204557771.png" alt="image-20210714204557771"></p><p>é¡¹ç›®ç»“æ„ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714204656214.png" alt="image-20210714204656214"></p><p>åœ¨ <code>feign-api</code> ä¸­ç„¶åå¼•å…¥ <code>feign</code> çš„ <code>starter</code> ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œ<code>order-service</code> ä¸­ç¼–å†™çš„ <code>UserClient</code>ã€<code>User</code>ã€<code>DefaultFeignConfiguration</code> éƒ½å¤åˆ¶åˆ° <code>feign-api</code> é¡¹ç›®ä¸­</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714205221970.png" alt="image-20210714205221970"></p><h4 id="_2ã€åœ¨order-serviceä¸­ä½¿ç”¨feign-api" tabindex="-1"><a class="header-anchor" href="#_2ã€åœ¨order-serviceä¸­ä½¿ç”¨feign-api" aria-hidden="true">#</a> 2ã€åœ¨order-serviceä¸­ä½¿ç”¨feign-api</h4><p>é¦–å…ˆï¼Œåˆ é™¤ <code>order-service</code> ä¸­çš„ <code>UserClient</code>ã€<code>User</code>ã€<code>DefaultFeignConfiguration</code> ç­‰ç±»æˆ–æ¥å£ã€‚</p><p>åœ¨ <code>order-service</code> çš„ <code>pom</code> æ–‡ä»¶ä¸­ä¸­å¼•å…¥ <code>feign-api</code> çš„ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.jmcoding.demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ <code>order-service</code> ä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„å¯¼åŒ…éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥ <code>feign-api</code> ä¸­çš„åŒ…</p><h4 id="_3ã€é‡å¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3ã€é‡å¯æµ‹è¯•" aria-hidden="true">#</a> 3ã€é‡å¯æµ‹è¯•</h4><p>é‡å¯åï¼Œå‘ç°æœåŠ¡æŠ¥é”™äº†ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714205623048.png" alt="image-20210714205623048"></p><p>è¿™æ˜¯å› ä¸º <code>UserClient</code> ç°åœ¨åœ¨ <code>com.jmcoding.feign.clients</code> åŒ…ä¸‹ï¼Œè€Œ <code>order-service</code> çš„ <code>@EnableFeignClients</code> æ³¨è§£æ˜¯åœ¨ <code>com.jmcoding.order</code> åŒ…ä¸‹ï¼Œä¸åœ¨åŒä¸€ä¸ªåŒ…ï¼Œæ— æ³•æ‰«æåˆ° <code>UserClient</code></p><h4 id="_4ã€è§£å†³æ‰«æåŒ…é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_4ã€è§£å†³æ‰«æåŒ…é—®é¢˜" aria-hidden="true">#</a> 4ã€è§£å†³æ‰«æåŒ…é—®é¢˜</h4><p>æ–¹å¼ä¸€ï¼šæŒ‡å®š <code>Feign</code> åº”è¯¥æ‰«æçš„åŒ…ï¼ˆè¿™ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šåŠ è½½ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.jmcoding.feign.clients&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ–¹å¼äºŒï¼šæŒ‡å®šéœ€è¦åŠ è½½çš„ <code>Client</code> æ¥å£ï¼ˆç²¾å‡†å®šä½ï¼Œæ¨èä½¿ç”¨è¿™ä¸ªï¼Œä¸ä¼šé€ æˆèµ„æºæµªè´¹ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>clients <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">UserClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="_3-gatewayæœåŠ¡ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_3-gatewayæœåŠ¡ç½‘å…³" aria-hidden="true">#</a> 3. GatewayæœåŠ¡ç½‘å…³</h1><blockquote><p><code>Spring Cloud Gateway</code> æ˜¯ <code>Spring Cloud</code> çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº <code>Spring 5.0</code>ï¼Œ<code>Spring Boot 2.0</code> å’Œ <code>Project Reactor</code> ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼</p></blockquote><h2 id="_3-1-ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_3-1-ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³" aria-hidden="true">#</a> 3.1 ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³</h2><blockquote><p><code>Gateway</code> ç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£</p></blockquote><p>ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p><ul><li>è¯·æ±‚è·¯ç”±</li><li>æƒé™æ§åˆ¶</li><li>é™æµ</li></ul><p>æ¶æ„å›¾ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714210131152.png" alt="image-20210714210131152"></p><p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p><p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡ <code>gateway</code>ï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p><p>åœ¨ <code>SpringCloud</code> ä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li><code>gateway</code></li><li><code>zuul</code></li></ul><p><code>Zuul</code> æ˜¯åŸºäº <code>Servlet</code> çš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€Œ <code>SpringCloudGateway</code> åˆ™æ˜¯åŸºäº <code>Spring5</code> ä¸­æä¾›çš„<code>WebFlux</code>ï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p><h2 id="_3-2-gatewayå¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_3-2-gatewayå¿«é€Ÿå…¥é—¨" aria-hidden="true">#</a> 3.2 gatewayå¿«é€Ÿå…¥é—¨</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ã€‚åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»º <code>SpringBoot</code> å·¥ç¨‹ <code>gateway</code>ï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</li><li>ç¼–å†™å¯åŠ¨ç±»</li><li>ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li><li>å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</li></ol><h3 id="_1ã€åˆ›å»ºgatewayæœåŠ¡-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1ã€åˆ›å»ºgatewayæœåŠ¡-å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> 1ã€åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ–</h3><p>åˆ›å»ºæœåŠ¡ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714210919458.png" alt="image-20210714210919458"></p><p>å¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--ç½‘å…³--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€ç¼–å†™å¯åŠ¨ç±»" tabindex="-1"><a class="header-anchor" href="#_2ã€ç¼–å†™å¯åŠ¨ç±»" aria-hidden="true">#</a> 2ã€ç¼–å†™å¯åŠ¨ç±»</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>gateway</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#_3ã€ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" aria-hidden="true">#</a> 3ã€ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</h3><p>åˆ›å»º <code>application.yml</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10010</span> <span class="token comment"># ç½‘å…³ç«¯å£</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment"># æœåŠ¡åç§°</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacosåœ°å€</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment"># ç½‘å…³è·¯ç”±é…ç½®</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>
          <span class="token comment"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userservice</code>ï¼Œ<code>lb</code> æ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="_4ã€é‡å¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4ã€é‡å¯æµ‹è¯•" aria-hidden="true">#</a> 4ã€é‡å¯æµ‹è¯•</h3><p>é‡å¯ç½‘å…³ï¼Œè®¿é—®<a href="http://localhost:10010/user/1%E6%97%B6%EF%BC%8C%E7%AC%A6%E5%90%88%60/user/**%60%E8%A7%84%E5%88%99%EF%BC%8C%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E5%88%B0uri%EF%BC%9Ahttp://userservice/user/1%EF%BC%8C%E5%BE%97%E5%88%B0%E4%BA%86%E7%BB%93%E6%9E%9C%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://localhost:10010/user/1æ—¶ï¼Œç¬¦åˆ\`/user/**\`è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘åˆ°uriï¼šhttp://userservice/user/1ï¼Œå¾—åˆ°äº†ç»“æœï¼š`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714211908341.png" alt="image-20210714211908341"></p><h3 id="_5ã€ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#_5ã€ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾" aria-hidden="true">#</a> 5ã€ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾</h3><p>æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714211742956.png" alt="image-20210714211742956"></p><h3 id="_6ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_6ã€æ€»ç»“" aria-hidden="true">#</a> 6ã€æ€»ç»“</h3><p>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</p><ol><li><p>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥ <code>nacos</code> æœåŠ¡å‘ç°å’Œ <code>gateway</code> ä¾èµ–</p></li><li><p>é…ç½® <code>application.yml</code>ï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€<code>nacos</code> åœ°å€ã€è·¯ç”±</p></li></ol><p>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</p><ol><li><p>è·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</p></li><li><p>è·¯ç”±ç›®æ ‡ï¼ˆ<code>uri</code>ï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œ<code>http</code> ä»£è¡¨å›ºå®šåœ°å€ï¼Œ<code>lb</code> ä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</p></li><li><p>è·¯ç”±æ–­è¨€ï¼ˆ<code>predicates</code>ï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™ï¼Œ</p></li><li><p>è·¯ç”±è¿‡æ»¤å™¨ï¼ˆ<code>filters</code>ï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</p></li></ol><blockquote><p>æ¥ä¸‹æ¥ï¼Œå°±é‡ç‚¹æ¥å­¦ä¹ è·¯ç”±æ–­è¨€å’Œè·¯ç”±è¿‡æ»¤å™¨çš„è¯¦ç»†çŸ¥è¯†</p></blockquote><h2 id="_3-3-æ–­è¨€å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_3-3-æ–­è¨€å·¥å‚" aria-hidden="true">#</a> 3.3 æ–­è¨€å·¥å‚</h2><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢« <code>Predicate Factory</code> è¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p><p>ä¾‹å¦‚ <code>Path=/user/**</code> æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p><p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>ç±»æ¥</p><p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨ <code>SpringCloudGateway</code> è¿˜æœ‰åå‡ ä¸ªï¼š</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>- After=2037-01-20T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Between=2037-01-20T17:42:47.789-07:00[America/Denver], 2037-01-21T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie=chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header=X-Request-Id, \\d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>- Host=<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method=GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path=/red/{segment},/blue/**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query=name, Jackæˆ–è€…- Query=name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr=192.168.1.1/24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td><td></td></tr></tbody></table><blockquote><p>æˆ‘ä»¬åªéœ€è¦æŒæ¡ <code>Path</code> è¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†</p></blockquote><h2 id="_3-4-è¿‡æ»¤å™¨å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_3-4-è¿‡æ»¤å™¨å·¥å‚" aria-hidden="true">#</a> 3.4 è¿‡æ»¤å™¨å·¥å‚</h2><p><code>GatewayFilter</code> æ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714212312871.png" alt="image-20210714212312871"></p><h3 id="_3-4-1-è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" tabindex="-1"><a class="header-anchor" href="#_3-4-1-è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" aria-hidden="true">#</a> 3.4.1 è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»</h3><p><code>Spring</code> æä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>AddRequestHeader</td><td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>RemoveRequestHeader</td><td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>AddResponseHeader</td><td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RemoveResponseHeader</td><td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RequestRateLimiter</td><td>é™åˆ¶è¯·æ±‚çš„æµé‡</td></tr><tr><td>...</td><td>...</td></tr></tbody></table><h3 id="_3-4-2-è¯·æ±‚å¤´è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_3-4-2-è¯·æ±‚å¤´è¿‡æ»¤å™¨" aria-hidden="true">#</a> 3.4.2 è¯·æ±‚å¤´è¿‡æ»¤å™¨</h3><p>ä¸‹é¢æˆ‘ä»¬ä»¥ <code>AddRequestHeader</code> ä¸ºä¾‹æ¥è®²è§£ã€‚</p><blockquote><p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥ <code>userservice</code> çš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼š<code>Truth=jmcoding is freaking awesome!</code></p></blockquote><p>åªéœ€è¦ä¿®æ”¹ <code>gateway</code> æœåŠ¡çš„ <code>application.yml</code> æ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service 
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice 
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> 
        <span class="token key atrule">filters</span><span class="token punctuation">:</span> <span class="token comment"># è¿‡æ»¤å™¨</span>
        <span class="token punctuation">-</span> AddRequestHeader=Truth<span class="token punctuation">,</span> jmcoding is freaking awesome<span class="token tag">!</span> <span class="token comment"># æ·»åŠ è¯·æ±‚å¤´</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å½“å‰è¿‡æ»¤å™¨å†™åœ¨ <code>userservice</code> è·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—® <code>userservice</code> çš„è¯·æ±‚æœ‰æ•ˆ</p></blockquote><h3 id="_3-4-3-é»˜è®¤è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_3-4-3-é»˜è®¤è¿‡æ»¤å™¨" aria-hidden="true">#</a> 3.4.3 é»˜è®¤è¿‡æ»¤å™¨</h3><p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ° <code>default</code> ä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service 
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice 
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span>
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span> <span class="token comment"># é»˜è®¤è¿‡æ»¤é¡¹</span>
      <span class="token punctuation">-</span> AddRequestHeader=Truth<span class="token punctuation">,</span> jmcoding is freaking awesome<span class="token tag">!</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-4-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_3-4-4-æ€»ç»“" aria-hidden="true">#</a> 3.4.4 æ€»ç»“</h3><p>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p><p>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</p><p><code>defaultFilters</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</p><h2 id="_3-5-å…¨å±€è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_3-5-å…¨å±€è¿‡æ»¤å™¨" aria-hidden="true">#</a> 3.5 å…¨å±€è¿‡æ»¤å™¨</h2><blockquote><p>ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°</p></blockquote><h3 id="_3-5-1-å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_3-5-1-å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" aria-hidden="true">#</a> 3.5.1 å…¨å±€è¿‡æ»¤å™¨ä½œç”¨</h3><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸ <code>GatewayFilter</code> çš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äº <code>GatewayFilter</code> é€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€Œ <code>GlobalFilter</code> çš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</p><p>å®šä¹‰æ–¹å¼æ˜¯å®ç° <code>GlobalFilter</code> æ¥å£ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡<span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">}</span>å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†
     *
     * <span class="token keyword">@param</span> <span class="token parameter">exchange</span> è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">chain</span> ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ 
     * <span class="token keyword">@return</span> <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span></span></span><span class="token punctuation">}</span> è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ
     */</span>
    <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>filter</code> ä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p><ul><li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li><li>æƒé™æ ¡éªŒ</li><li>è¯·æ±‚é™æµç­‰</li></ul><h3 id="_3-5-2-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_3-5-2-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" aria-hidden="true">#</a> 3.5.2 è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</h3><p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p><ul><li><p>å‚æ•°ä¸­æ˜¯å¦æœ‰ <code>authorization</code></p></li><li><p><code>authorization</code>å‚æ•°å€¼æ˜¯å¦ä¸º <code>admin</code></p></li></ul><p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p><p>å®ç°ï¼š</p><p>åœ¨ <code>gateway</code> ä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jmcoding<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filters</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.è·å–è¯·æ±‚å‚æ•°</span>
        <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.è·å–authorizationå‚æ•°</span>
        <span class="token class-name">String</span> auth <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;authorization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.æ ¡éªŒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ”¾è¡Œ</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4.æ‹¦æˆª</span>
        <span class="token comment">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span>
        exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.2.ç»“æŸå¤„ç†</span>
        <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-3-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#_3-5-3-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" aria-hidden="true">#</a> 3.5.3 è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</h3><p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€<code>DefaultFilter</code>ã€<code>GlobalFilter</code></p><p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’Œ <code>DefaultFilter</code> ã€<code>GlobalFilter</code>ï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714214228409.png" alt="image-20210714214228409"></p><p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ª <code>int</code> ç±»å‹çš„ <code>order</code> å€¼ï¼Œ<strong><code>order</code> å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li><li><code>GlobalFilter</code> é€šè¿‡å®ç° <code>Ordered</code> æ¥å£ï¼Œæˆ–è€…æ·»åŠ  <code>@Order</code> æ³¨è§£æ¥æŒ‡å®š <code>order</code> å€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li><li>è·¯ç”±è¿‡æ»¤å™¨å’Œ <code>defaultFilter</code> çš„ <code>order</code> ç”± <code>Spring</code> æŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li><li>å½“è¿‡æ»¤å™¨çš„ <code>order</code> å€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ <code>defaultFilter</code> &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; <code>GlobalFilter</code> çš„é¡ºåºæ‰§è¡Œã€‚</li></ul><p>è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š</p><p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p><p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p><h2 id="_3-6-è·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-6-è·¨åŸŸé—®é¢˜" aria-hidden="true">#</a> 3.6 è·¨åŸŸé—®é¢˜</h2><h3 id="_3-6-1-ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-6-1-ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜" aria-hidden="true">#</a> 3.6.1 ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</h3><p>è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><p>åŸŸåä¸åŒï¼š <a href="http://www.taobao.com" target="_blank" rel="noopener noreferrer">www.taobao.com`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a> å’Œ <a href="http://www.taobao.org" target="_blank" rel="noopener noreferrer">www.taobao.org`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a> å’Œ <a href="http://www.jd.com" target="_blank" rel="noopener noreferrer">www.jd.com`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a> å’Œ <a href="http://miaosha.jd.com" target="_blank" rel="noopener noreferrer">miaosha.jd.com`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a></p></li><li><p>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼š<code>localhost:8080</code> å’Œ <code>localhost:8081</code></p></li></ul><p>è·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸ <code>ajax</code> è¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p><p>è§£å†³æ–¹æ¡ˆï¼š<code>CORS</code>ï¼Œè¿™ä¸ªä»¥å‰åº”è¯¥å­¦ä¹ è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚ä¸çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹<a href="https://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">https://www.ruanyifeng.com/blog/2016/04/cors.html`);
  _push(ssrRenderComponent(_component_ExternalLinkIcon, null, null, _parent));
  _push(`</a></p><h3 id="_3-6-2-æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-6-2-æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜" aria-hidden="true">#</a> 3.6.2 æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜</h3><p>æ‰¾åˆ°è¯¾å‰èµ„æ–™çš„é¡µé¢æ–‡ä»¶ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714215713563.png" alt="image-20210714215713563"></p><p>æ”¾å…¥ <code>tomcat</code> æˆ–è€… <code>nginx</code> è¿™æ ·çš„ <code>web</code> æœåŠ¡å™¨ä¸­ï¼Œå¯åŠ¨å¹¶è®¿é—®ã€‚</p><p>å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/1273/image-20210714215832675.png" alt="image-20210714215832675"></p><p>ä» <code>localhost:8090</code> è®¿é—® <code>localhost:10010</code>ï¼Œç«¯å£ä¸åŒï¼Œæ˜¾ç„¶æ˜¯è·¨åŸŸçš„è¯·æ±‚ã€‚</p><h3 id="_3-6-3-è§£å†³è·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_3-6-3-è§£å†³è·¨åŸŸé—®é¢˜" aria-hidden="true">#</a> 3.6.3 è§£å†³è·¨åŸŸé—®é¢˜</h3><p>åœ¨ <code>gateway</code> æœåŠ¡çš„ <code>application.yml</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># ã€‚ã€‚ã€‚</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span> <span class="token comment"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span>
        <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">&#39;[/**]&#39;</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span>
              <span class="token punctuation">-</span> <span class="token string">&quot;http://localhost:8090&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token comment"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;GET&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;POST&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;DELETE&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;PUT&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;OPTIONS&quot;</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span> <span class="token comment"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span>
            <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¯å¦å…è®¸æºå¸¦cookie</span>
            <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">360000</span> <span class="token comment"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>`);
}
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("../pages/codenotes/framework/MicroServices/SpringCloud02.html.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
const SpringCloud02_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["ssrRender", _sfc_ssrRender], ["__file", "SpringCloud02.html.vue"]]);
export {
  SpringCloud02_html as default
};
